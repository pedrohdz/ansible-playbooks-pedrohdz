---
- name: Ensure Nix Homeâ€‘Manager is installed
  ansible.builtin.shell:
    executable: /bin/bash
    cmd: |
      set -o errexit
      set -o nounset
      set -o pipefail

      source /etc/profile.d/nix.sh

      nix \
        run "github:nix-community/home-manager/{{ phdz_nix_home_manager_version }}" \
        -- \
        switch --flake '{{ phdz_nix_home_manager_flake_uri }}'

    creates: >-
      {{ phdz_nix_home_manager_home_dir }}/.local/state/nix/profiles/home-manager
